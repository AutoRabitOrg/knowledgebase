# Creating Custom Rules with XPath

[CodeScan](https://www.codescan.io/) allows you to create custom rules using XPath. You can use these rules to trigger violations based on any special requirements you may have.\


Note:

1. The custom XPath Visualforce rule template uses **XPath version 2** whereas the custom XPath Apex rule template uses **XPath version 1**.
2. This needs to be changed in the design as the rules are being developed or could introduce bugs.

### Before you begin <a href="#before-you-begin" id="before-you-begin"></a>

* You will need an excellent working knowledge of XPath to get this operational.
* [Download the **Apex-Custom Rule Designer**](https://license.codescan.io/index.php/download/login?path=codescan-designer-22.6.2.jar) .

Installing the Apex-Custom Rule Designer

Run the following command to install the downloaded _Apex-Custom Rule Designer_:

```
java -jar <jar-file-name>.jar
```

### Apex <a href="#apex" id="apex"></a>

Here are some examples of XPath queries for Apex.

**Naming:**

* XPath queries can be used to catch unwanted trends or enforce standards in the naming of your classes, methods, and variables.
* This query will catch any class names that do not start with _**PREFIX\_**_

```
//ClassOrInterfaceDeclaration
[
  not(starts-with(@Image, 'PREFIX_'))
]
```

This example would catch the first class here:

```
class NewClass{}
class PREFIX_NewClass{}
```

_**starts-with**_ can also be replaced with:

* _**ends-with**_ - This checks for a string at the end of the @image name.
* _**matches**_ - This uses the regular expression in place of the string to check for patterns in the @image name.

Note:

When using a regular expression with escapes ( \ character) in XPath, you will need to double escape them when adding them in the UI due to the way our rule engine parses them.

eg. **\\.** will become **\\\\.**

### Visualforce and Aura Lightning <a href="#visualforce-and-aura-lightning" id="visualforce-and-aura-lightning"></a>

You can also use this technique for VisualForce (in the Apex-Custom Rule designer, select the **VisualForce** language and use **XPath 2.0** instead of **XPath 1.0**).

**Naming:**

XPath queries can be used to catch unwanted trends or enforce standards in the naming of your pages.

This query will catch any page names that do not start with _**PREFIX\_**_

```
//Document [@Filename[not(starts-with(.,'PREFIX_'))]]
```

This example would catch the first Filename here, but ignore the second:

```
NewPage.page
PREFIX_NewPage.page
```

_**starts-with**_ can also be replaced with:

* _**ends-with**_ - This checks for a string at the end of the @image name.
* _**matches**_ - This uses the regular expression in place of the string to check for patterns in the @image name.

### Other Salesforce metadata <a href="#other-salesforce-metadata" id="other-salesforce-metadata"></a>

Most other metadata types come out of Salesforce in XML format. To scan these types, you can add any metadata you want to the list of file suffixes as seen in the [Enable CodeScan Cloud Metadata Rules](https://knowledgebase.autorabit.com/codescan/docs/enable-codescan-cloud-metadata-rules) article.

XPath expressions for Salesforce metadata should start with double-slashes (“//”).\
For example-

```
//ValidationRule
```

Point to Note:

In CodeScan Designer, verify the XPath expressions. Using an XPath expression generated by any other online tool may not work because the XPath expression is dependent on how the AST is generated, which varies per tool.

If you want to create a rule for a new metadata type, spend time looking at the XML to determine where your fields, rules, decisions, or subtasks are, and then look into how to validate them.\
**For example**, if you want to limit a flow to 20 decision points, the XPath would look something like this:

```
//Flow[
 count(./decisions)>20
]

```

The type of component being visualized is flow. Decisions exist within that flow; they are a direct child of the flow within the XML. Finally, the count () method can determine if there are too many flows.
